(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'swarm-game');

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));

game.state.start('Boot');

},{"./states/boot":"/Users/benjaminyu/swarm/src/js/states/boot.js","./states/game":"/Users/benjaminyu/swarm/src/js/states/game.js","./states/menu":"/Users/benjaminyu/swarm/src/js/states/menu.js","./states/preloader":"/Users/benjaminyu/swarm/src/js/states/preloader.js","./states/splash":"/Users/benjaminyu/swarm/src/js/states/splash.js","./utils":"/Users/benjaminyu/swarm/src/js/utils.js"}],"/Users/benjaminyu/swarm/src/js/entities/enemy.js":[function(require,module,exports){
var Enemy = function (index, game, player, bmd) {
    var x = game.world.randomX;
    var y = game.world.randomY;

    this.game = game;
    this.health = 3;
    this.player = player;
    this.alive = true;

    this.sprite = game.add.sprite(x, y, bmd);
    this.sprite.anchor.set(0.5);

    this.sprite.name = index.toString();
    game.physics.enable(this.sprite, Phaser.Physics.ARCADE);
    this.sprite.body.immovable = false;
    this.sprite.body.collideWorldBounds = true;
    this.sprite.body.bounce.setTo(1, 1);

    this.sprite.angle = game.rnd.angle();

    game.physics.arcade.velocityFromRotation(this.sprite.rotation, 150, this.sprite.body.velocity);
}

Enemy.prototype = Object.create(Phaser.Sprite.prototype);
Enemy.prototype.constructor = Enemy;


Enemy.prototype.update = function(enemies) {
    var neighbourCount = 0;
    // Alignment
    var alignVel = new Phaser.Point();
    var cohesionVel = new Phaser.Point();
    var seperationVel = new Phaser.Point();
    alignVel.copyFrom(this.sprite.body.velocity);
    if (enemies) {
        for (var i = enemies.length - 1; i >= 0; i--) {
            if(enemies[i] != this && this.game.physics.arcade.distanceBetween(this.sprite.body, enemies[i].sprite.body) < 150) {
                // Average Velocity of Group
                alignVel.add(enemies[i].sprite.body.velocity.x,enemies[i].sprite.body.velocity.y);
                // Center of Mass of Group
                cohesionVel.add(enemies[i].sprite.body.position.x,enemies[i].sprite.body.position.y)
                seperationVel.add(enemies[i].sprite.body.position.x-this.sprite.body.position.x,enemies[i].sprite.body.position.y-this.sprite.body.position.y)
                neighbourCount += 1;
            }
        };
        if (neighbourCount > 0) {
            alignVel = Phaser.Point.normalize(alignVel);
            alignVel.multiply(150,150);
            cohesionVel.multiply(1/neighbourCount,1/neighbourCount);
            cohesionVel.set(cohesionVel.x - this.sprite.body.position.x,cohesionVel.y - this.sprite.body.position.y);
            cohesionVel = Phaser.Point.normalize(cohesionVel);
            cohesionVel.multiply(150,150);
            seperationVel.multiply(1/neighbourCount,1/neighbourCount);
            seperationVel.multiply(-1,-1);
            seperationVel = Phaser.Point.normalize(seperationVel);
            seperationVel.multiply(150,150);
        }
        this.sprite.body.velocity.set(0.2*alignVel.x+0.2*cohesionVel.x+0.25*seperationVel.x,0.2*alignVel.y+0.2*cohesionVel.y+0.25*seperationVel.y);
        this.sprite.body.velocity = Phaser.Point.normalize(this.sprite.body.velocity);
        this.sprite.body.velocity.multiply(150,150);
    }
};

module.exports = Enemy;

},{}],"/Users/benjaminyu/swarm/src/js/entities/player.js":[function(require,module,exports){
var Player = function (game, x, y) {
    Phaser.Sprite.call(this, game, x, y, 'testsprite');
    game.add.existing(this);
}

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function() {
};

module.exports = Player;

},{}],"/Users/benjaminyu/swarm/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      this.game.stage.scale.minWidth =  480;
      this.game.stage.scale.minHeight = 260;
      this.game.stage.scale.maxWidth = 640;
      this.game.stage.scale.maxHeight = 480;
      this.game.stage.scale.forceLandscape = true;
      this.game.stage.scale.pageAlignHorizontally = true;
      this.game.stage.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/benjaminyu/swarm/src/js/states/game.js":[function(require,module,exports){
var Player = require('../entities/player');
var Enemy = require('../entities/enemy');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    var x = (this.game.width / 2) - 100;
    var y = (this.game.height / 2) - 50;

    // Create BitmapData
    this.enemy_bmd = this.game.add.bitmapData(100,100);

    // Draw circle
    this.enemy_bmd.ctx.fillStyle = '#000000';
    this.enemy_bmd.ctx.shadowColor = '#00ff00';
    this.enemy_bmd.ctx.shadowBlur = 40;
    this.enemy_bmd.ctx.shadowOffsetX = 0;
    this.enemy_bmd.ctx.shadowOffsetY = 0;
    this.enemy_bmd.ctx.beginPath();
    this.enemy_bmd.ctx.arc(50, 50, 10, 0, Math.PI*2, true); 
    this.enemy_bmd.ctx.closePath();
    this.enemy_bmd.ctx.fill();

    this.testentity = new Player(this.game, x, y);
    this.testentity.anchor.setTo(0.5, 0.5);

    //  Create some enemies
    this.enemies = [];

    this.enemiesTotal = 20;
    this.enemiesAlive = 20;

    for (var i = 0; i < this.enemiesTotal; i++)
    {
        this.enemies.push(new Enemy(i, this.game, this.testentity, this.enemy_bmd));
    }

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
    var x, y, cx, cy, dx, dy, angle, scale;

    x = this.input.position.x;
    y = this.input.position.y;
    cx = this.world.centerX;
    cy = this.world.centerY;

    angle = Math.atan2(y - cy, x - cx) * (180 / Math.PI);
    this.testentity.angle = angle;

    dx = x - cx;
    dy = y - cy;
    scale = Math.sqrt(dx * dx + dy * dy) / 100;

    this.testentity.scale.x = scale * 0.6;
    this.testentity.scale.y = scale * 0.6;

    for (var i = 0; i < this.enemies.length; i++) {
        if (this.enemies[i].alive)
        {
           this.enemies[i].update(this.enemies);
        }
    }

  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/enemy":"/Users/benjaminyu/swarm/src/js/entities/enemy.js","../entities/player":"/Users/benjaminyu/swarm/src/js/entities/player.js"}],"/Users/benjaminyu/swarm/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],"/Users/benjaminyu/swarm/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('testsprite', 'assets/test.png');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"/Users/benjaminyu/swarm/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/benjaminyu/swarm/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["./src/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9iZW5qYW1pbnl1L3N3YXJtL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuL3NyYy9qcy9tYWluLmpzIiwiL1VzZXJzL2JlbmphbWlueXUvc3dhcm0vc3JjL2pzL2VudGl0aWVzL2VuZW15LmpzIiwiL1VzZXJzL2JlbmphbWlueXUvc3dhcm0vc3JjL2pzL2VudGl0aWVzL3BsYXllci5qcyIsIi9Vc2Vycy9iZW5qYW1pbnl1L3N3YXJtL3NyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsIi9Vc2Vycy9iZW5qYW1pbnl1L3N3YXJtL3NyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsIi9Vc2Vycy9iZW5qYW1pbnl1L3N3YXJtL3NyYy9qcy9zdGF0ZXMvbWVudS5qcyIsIi9Vc2Vycy9iZW5qYW1pbnl1L3N3YXJtL3NyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwiL1VzZXJzL2JlbmphbWlueXUvc3dhcm0vc3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCIvVXNlcnMvYmVuamFtaW55dS9zd2FybS9zcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnc3dhcm0tZ2FtZScpO1xuXG53aW5kb3cuVXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7XG53aW5kb3cucGxheWVyU3RhdGUgPSB7XG4gICAgY3VycmVudExldmVsOiAnR2FtZSdcbn1cblxuZ2FtZS5zdGF0ZS5hZGQoJ0Jvb3QnLCByZXF1aXJlKCcuL3N0YXRlcy9ib290JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1NwbGFzaCcsIHJlcXVpcmUoJy4vc3RhdGVzL3NwbGFzaCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdQcmVsb2FkZXInLCByZXF1aXJlKCcuL3N0YXRlcy9wcmVsb2FkZXInKSk7XG5nYW1lLnN0YXRlLmFkZCgnTWVudScsIHJlcXVpcmUoJy4vc3RhdGVzL21lbnUnKSk7XG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWUnKSk7XG5cbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiIsInZhciBFbmVteSA9IGZ1bmN0aW9uIChpbmRleCwgZ2FtZSwgcGxheWVyLCBibWQpIHtcbiAgICB2YXIgeCA9IGdhbWUud29ybGQucmFuZG9tWDtcbiAgICB2YXIgeSA9IGdhbWUud29ybGQucmFuZG9tWTtcblxuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgdGhpcy5oZWFsdGggPSAzO1xuICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xuICAgIHRoaXMuYWxpdmUgPSB0cnVlO1xuXG4gICAgdGhpcy5zcHJpdGUgPSBnYW1lLmFkZC5zcHJpdGUoeCwgeSwgYm1kKTtcbiAgICB0aGlzLnNwcml0ZS5hbmNob3Iuc2V0KDAuNSk7XG5cbiAgICB0aGlzLnNwcml0ZS5uYW1lID0gaW5kZXgudG9TdHJpbmcoKTtcbiAgICBnYW1lLnBoeXNpY3MuZW5hYmxlKHRoaXMuc3ByaXRlLCBQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xuICAgIHRoaXMuc3ByaXRlLmJvZHkuaW1tb3ZhYmxlID0gZmFsc2U7XG4gICAgdGhpcy5zcHJpdGUuYm9keS5jb2xsaWRlV29ybGRCb3VuZHMgPSB0cnVlO1xuICAgIHRoaXMuc3ByaXRlLmJvZHkuYm91bmNlLnNldFRvKDEsIDEpO1xuXG4gICAgdGhpcy5zcHJpdGUuYW5nbGUgPSBnYW1lLnJuZC5hbmdsZSgpO1xuXG4gICAgZ2FtZS5waHlzaWNzLmFyY2FkZS52ZWxvY2l0eUZyb21Sb3RhdGlvbih0aGlzLnNwcml0ZS5yb3RhdGlvbiwgMTUwLCB0aGlzLnNwcml0ZS5ib2R5LnZlbG9jaXR5KTtcbn1cblxuRW5lbXkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5FbmVteS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBFbmVteTtcblxuXG5FbmVteS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oZW5lbWllcykge1xuICAgIHZhciBuZWlnaGJvdXJDb3VudCA9IDA7XG4gICAgLy8gQWxpZ25tZW50XG4gICAgdmFyIGFsaWduVmVsID0gbmV3IFBoYXNlci5Qb2ludCgpO1xuICAgIHZhciBjb2hlc2lvblZlbCA9IG5ldyBQaGFzZXIuUG9pbnQoKTtcbiAgICB2YXIgc2VwZXJhdGlvblZlbCA9IG5ldyBQaGFzZXIuUG9pbnQoKTtcbiAgICBhbGlnblZlbC5jb3B5RnJvbSh0aGlzLnNwcml0ZS5ib2R5LnZlbG9jaXR5KTtcbiAgICBpZiAoZW5lbWllcykge1xuICAgICAgICBmb3IgKHZhciBpID0gZW5lbWllcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgaWYoZW5lbWllc1tpXSAhPSB0aGlzICYmIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5kaXN0YW5jZUJldHdlZW4odGhpcy5zcHJpdGUuYm9keSwgZW5lbWllc1tpXS5zcHJpdGUuYm9keSkgPCAxNTApIHtcbiAgICAgICAgICAgICAgICAvLyBBdmVyYWdlIFZlbG9jaXR5IG9mIEdyb3VwXG4gICAgICAgICAgICAgICAgYWxpZ25WZWwuYWRkKGVuZW1pZXNbaV0uc3ByaXRlLmJvZHkudmVsb2NpdHkueCxlbmVtaWVzW2ldLnNwcml0ZS5ib2R5LnZlbG9jaXR5LnkpO1xuICAgICAgICAgICAgICAgIC8vIENlbnRlciBvZiBNYXNzIG9mIEdyb3VwXG4gICAgICAgICAgICAgICAgY29oZXNpb25WZWwuYWRkKGVuZW1pZXNbaV0uc3ByaXRlLmJvZHkucG9zaXRpb24ueCxlbmVtaWVzW2ldLnNwcml0ZS5ib2R5LnBvc2l0aW9uLnkpXG4gICAgICAgICAgICAgICAgc2VwZXJhdGlvblZlbC5hZGQoZW5lbWllc1tpXS5zcHJpdGUuYm9keS5wb3NpdGlvbi54LXRoaXMuc3ByaXRlLmJvZHkucG9zaXRpb24ueCxlbmVtaWVzW2ldLnNwcml0ZS5ib2R5LnBvc2l0aW9uLnktdGhpcy5zcHJpdGUuYm9keS5wb3NpdGlvbi55KVxuICAgICAgICAgICAgICAgIG5laWdoYm91ckNvdW50ICs9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChuZWlnaGJvdXJDb3VudCA+IDApIHtcbiAgICAgICAgICAgIGFsaWduVmVsID0gUGhhc2VyLlBvaW50Lm5vcm1hbGl6ZShhbGlnblZlbCk7XG4gICAgICAgICAgICBhbGlnblZlbC5tdWx0aXBseSgxNTAsMTUwKTtcbiAgICAgICAgICAgIGNvaGVzaW9uVmVsLm11bHRpcGx5KDEvbmVpZ2hib3VyQ291bnQsMS9uZWlnaGJvdXJDb3VudCk7XG4gICAgICAgICAgICBjb2hlc2lvblZlbC5zZXQoY29oZXNpb25WZWwueCAtIHRoaXMuc3ByaXRlLmJvZHkucG9zaXRpb24ueCxjb2hlc2lvblZlbC55IC0gdGhpcy5zcHJpdGUuYm9keS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgIGNvaGVzaW9uVmVsID0gUGhhc2VyLlBvaW50Lm5vcm1hbGl6ZShjb2hlc2lvblZlbCk7XG4gICAgICAgICAgICBjb2hlc2lvblZlbC5tdWx0aXBseSgxNTAsMTUwKTtcbiAgICAgICAgICAgIHNlcGVyYXRpb25WZWwubXVsdGlwbHkoMS9uZWlnaGJvdXJDb3VudCwxL25laWdoYm91ckNvdW50KTtcbiAgICAgICAgICAgIHNlcGVyYXRpb25WZWwubXVsdGlwbHkoLTEsLTEpO1xuICAgICAgICAgICAgc2VwZXJhdGlvblZlbCA9IFBoYXNlci5Qb2ludC5ub3JtYWxpemUoc2VwZXJhdGlvblZlbCk7XG4gICAgICAgICAgICBzZXBlcmF0aW9uVmVsLm11bHRpcGx5KDE1MCwxNTApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3ByaXRlLmJvZHkudmVsb2NpdHkuc2V0KDAuMiphbGlnblZlbC54KzAuMipjb2hlc2lvblZlbC54KzAuMjUqc2VwZXJhdGlvblZlbC54LDAuMiphbGlnblZlbC55KzAuMipjb2hlc2lvblZlbC55KzAuMjUqc2VwZXJhdGlvblZlbC55KTtcbiAgICAgICAgdGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eSA9IFBoYXNlci5Qb2ludC5ub3JtYWxpemUodGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eSk7XG4gICAgICAgIHRoaXMuc3ByaXRlLmJvZHkudmVsb2NpdHkubXVsdGlwbHkoMTUwLDE1MCk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBFbmVteTtcbiIsInZhciBQbGF5ZXIgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSkge1xuICAgIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAndGVzdHNwcml0ZScpO1xuICAgIGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xufVxuXG5QbGF5ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5QbGF5ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5QbGF5ZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXI7XG4iLCJ2YXIgQm9vdCA9IGZ1bmN0aW9uICgpIHt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7XG5cbkJvb3QucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3ByZWxvYWRlcicsICdhc3NldHMvcHJlbG9hZGVyLmdpZicpO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5pbnB1dC5tYXhQb2ludGVycyA9IDE7XG5cbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKSB7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlTW9kZSA9IFBoYXNlci5TdGFnZVNjYWxlTW9kZS5TSE9XX0FMTDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5taW5XaWR0aCA9ICA0ODA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWluSGVpZ2h0ID0gMjYwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1heFdpZHRoID0gNjQwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1heEhlaWdodCA9IDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5mb3JjZUxhbmRzY2FwZSA9IHRydWU7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xuICAgIH1cblxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnUHJlbG9hZGVyJyk7XG4gIH1cbn07XG4iLCJ2YXIgUGxheWVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvcGxheWVyJyk7XG52YXIgRW5lbXkgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9lbmVteScpO1xuXG52YXIgR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXN0ZW50aXR5ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcblxuR2FtZS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSAodGhpcy5nYW1lLndpZHRoIC8gMikgLSAxMDA7XG4gICAgdmFyIHkgPSAodGhpcy5nYW1lLmhlaWdodCAvIDIpIC0gNTA7XG5cbiAgICAvLyBDcmVhdGUgQml0bWFwRGF0YVxuICAgIHRoaXMuZW5lbXlfYm1kID0gdGhpcy5nYW1lLmFkZC5iaXRtYXBEYXRhKDEwMCwxMDApO1xuXG4gICAgLy8gRHJhdyBjaXJjbGVcbiAgICB0aGlzLmVuZW15X2JtZC5jdHguZmlsbFN0eWxlID0gJyMwMDAwMDAnO1xuICAgIHRoaXMuZW5lbXlfYm1kLmN0eC5zaGFkb3dDb2xvciA9ICcjMDBmZjAwJztcbiAgICB0aGlzLmVuZW15X2JtZC5jdHguc2hhZG93Qmx1ciA9IDQwO1xuICAgIHRoaXMuZW5lbXlfYm1kLmN0eC5zaGFkb3dPZmZzZXRYID0gMDtcbiAgICB0aGlzLmVuZW15X2JtZC5jdHguc2hhZG93T2Zmc2V0WSA9IDA7XG4gICAgdGhpcy5lbmVteV9ibWQuY3R4LmJlZ2luUGF0aCgpO1xuICAgIHRoaXMuZW5lbXlfYm1kLmN0eC5hcmMoNTAsIDUwLCAxMCwgMCwgTWF0aC5QSSoyLCB0cnVlKTsgXG4gICAgdGhpcy5lbmVteV9ibWQuY3R4LmNsb3NlUGF0aCgpO1xuICAgIHRoaXMuZW5lbXlfYm1kLmN0eC5maWxsKCk7XG5cbiAgICB0aGlzLnRlc3RlbnRpdHkgPSBuZXcgUGxheWVyKHRoaXMuZ2FtZSwgeCwgeSk7XG4gICAgdGhpcy50ZXN0ZW50aXR5LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICAvLyAgQ3JlYXRlIHNvbWUgZW5lbWllc1xuICAgIHRoaXMuZW5lbWllcyA9IFtdO1xuXG4gICAgdGhpcy5lbmVtaWVzVG90YWwgPSAyMDtcbiAgICB0aGlzLmVuZW1pZXNBbGl2ZSA9IDIwO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVuZW1pZXNUb3RhbDsgaSsrKVxuICAgIHtcbiAgICAgICAgdGhpcy5lbmVtaWVzLnB1c2gobmV3IEVuZW15KGksIHRoaXMuZ2FtZSwgdGhpcy50ZXN0ZW50aXR5LCB0aGlzLmVuZW15X2JtZCkpO1xuICAgIH1cblxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uSW5wdXREb3duLCB0aGlzKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCwgeSwgY3gsIGN5LCBkeCwgZHksIGFuZ2xlLCBzY2FsZTtcblxuICAgIHggPSB0aGlzLmlucHV0LnBvc2l0aW9uLng7XG4gICAgeSA9IHRoaXMuaW5wdXQucG9zaXRpb24ueTtcbiAgICBjeCA9IHRoaXMud29ybGQuY2VudGVyWDtcbiAgICBjeSA9IHRoaXMud29ybGQuY2VudGVyWTtcblxuICAgIGFuZ2xlID0gTWF0aC5hdGFuMih5IC0gY3ksIHggLSBjeCkgKiAoMTgwIC8gTWF0aC5QSSk7XG4gICAgdGhpcy50ZXN0ZW50aXR5LmFuZ2xlID0gYW5nbGU7XG5cbiAgICBkeCA9IHggLSBjeDtcbiAgICBkeSA9IHkgLSBjeTtcbiAgICBzY2FsZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSkgLyAxMDA7XG5cbiAgICB0aGlzLnRlc3RlbnRpdHkuc2NhbGUueCA9IHNjYWxlICogMC42O1xuICAgIHRoaXMudGVzdGVudGl0eS5zY2FsZS55ID0gc2NhbGUgKiAwLjY7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZW5lbWllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAodGhpcy5lbmVtaWVzW2ldLmFsaXZlKVxuICAgICAgICB7XG4gICAgICAgICAgIHRoaXMuZW5lbWllc1tpXS51cGRhdGUodGhpcy5lbmVtaWVzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICB9LFxuXG4gIG9uSW5wdXREb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gIH1cbn07XG4iLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXh0ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWVudTtcblxuTWVudS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyO1xuICAgIHZhciB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XG5cbiAgICB2YXIgc3R5bGUgPSB7IGZvbnQ6IFwiNjVweCBBcmlhbFwiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfTtcblxuICAgIHRoaXMudGV4dCA9IHRoaXMuYWRkLnRleHQoeCAtIDMwMCwgeSAtIDIwMCwgXCJQcmVzcyB0byBTdGFydFwiLCBzdHlsZSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIG9uRG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpO1xuICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgzMjAsIDI0MCwgJ3ByZWxvYWRlcicpO1xuICAgIHRoaXMuYXNzZXQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgndGVzdHNwcml0ZScsICdhc3NldHMvdGVzdC5wbmcnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmFzc2V0LmNyb3BFbmFibGVkID0gZmFsc2U7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCEhdGhpcy5yZWFkeSkge1xuICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gICAgfVxuICB9LFxuXG4gIG9uTG9hZENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gIH1cbn07XG4iLCJ2YXIgU3BsYXNoID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTcGxhc2g7XG5cblNwbGFzaC5wcm90b3R5cGUgPSB7XG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICB9XG59OyIsInZhciBVdGlscyA9IHtcbiAgICBjb250YWluc09iamVjdDogZnVuY3Rpb24ob2JqLCBsaXN0KSB7XG4gICAgICAgIHZhciBpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGxpc3RbaV0gPT09IG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVXRpbHM7Il19
